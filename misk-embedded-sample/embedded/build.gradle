buildscript {
  dependencies {
    classpath dep.shadowJarPlugin
  }
}

apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
  implementation project(':misk-embedded-sample:service')
  // TODO(maacosta) before this can be used by any misk service wesomehow exclude this from the
  //  above dependencies:
  //  compile project(':misk-embedded-sample:client')
}

shadowJar {
  baseName = 'misk.embedded.sample.embedded.EmbeddedSampleService'
  classifier = ''
  archiveVersion = ''
  dependencies {
    exclude(project(':misk-embedded-sample:client'))
    // TODO: Here were are manually excluding the client's dependencies.
    //  before this can be used in general by any misk project, this exclusion needs to be done
    //  by the build task. There might be some complexity if transitive dependencies also need to be
    //  excluded.
    exclude(dependency(dep.kotlinStdLibJdk8))
    exclude(dependency(dep.guava))
    exclude(dependency(dep.guice))
    exclude(dependency(dep.javaxInject))
  }
}

jar {
  dependsOn 'shadowJar'
  from (files('./build/libs/misk.embedded.sample.embedded.EmbeddedSampleService.jar'))
}
