
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Misk: Microservice Container for Kotlin">
      
      
        <meta name="author" content="Square, Inc.">
      
      
      
        <link rel="prev" href="../getting-started/">
      
      
        <link rel="next" href="../multipart/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Actions - Misk</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/app.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#actions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Misk" class="md-header__button md-logo" aria-label="Misk" data-md-component="logo">
      
  <img src="../img/cashapp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Misk
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Actions
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cashapp/misk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Misk
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Misk" class="md-nav__button md-logo" aria-label="Misk" data-md-component="logo">
      
  <img src="../img/cashapp.png" alt="logo">

    </a>
    Misk
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cashapp/misk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Misk
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#web-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Web Actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-http-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up HTTP actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-type" class="md-nav__link">
    <span class="md-ellipsis">
      Response type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpc-actions" class="md-nav__link">
    <span class="md-ellipsis">
      gRPC Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actionscoped" class="md-nav__link">
    <span class="md-ellipsis">
      ActionScoped
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-action-classes-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Test Action classes directly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-actionscoped" class="md-nav__link">
    <span class="md-ellipsis">
      Testing ActionScoped
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Integration tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multipart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multipart Forms
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../clients/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clients
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    0.x API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            0.x API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-aws
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-aws-dynamodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-aws-dynamodb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-aws2-dynamodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-aws2-dynamodb
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-crypto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-eventrouter/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-eventrouter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-events-core/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-events-core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-events/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-gcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-gcp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-grpc-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-grpc-tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-hibernate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-hibernate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-hibernate-testing/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-hibernate-testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-inject/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-inject
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-jobqueue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-jobqueue
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-jobqueue-testing/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-jobqueue-testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-metrics-digester/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-metrics-digester
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-prometheus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-prometheus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-redis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-zookeeper/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-zookeeper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0.x/misk-zoopkeeper-testing/index.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    misk-zoopkeeper-testing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Internals
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Internals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internals/graceful-shutdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graceful Shutdown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internals/service-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wisp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wisp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Migrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Migrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../migrations/misk-metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Misk Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Change Log
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../releasing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Releasing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://stackoverflow.com/questions/tagged/misk?sort=active" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stack Overflow ⏏
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#web-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Web Actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-http-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up HTTP actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#response-type" class="md-nav__link">
    <span class="md-ellipsis">
      Response type
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grpc-actions" class="md-nav__link">
    <span class="md-ellipsis">
      gRPC Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actionscoped" class="md-nav__link">
    <span class="md-ellipsis">
      ActionScoped
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-action-classes-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Test Action classes directly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-actionscoped" class="md-nav__link">
    <span class="md-ellipsis">
      Testing ActionScoped
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Integration tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="actions">Actions<a class="headerlink" href="#actions" title="Permanent link">&para;</a></h1>
<p>Actions are Misk&rsquo;s unit for an endpoint. Misk lets you make HTTP actions, and gRPC actions via 
<a href="https://github.com/square/wire">Wire</a>.</p>
<h2 id="web-actions">Web Actions<a class="headerlink" href="#web-actions" title="Permanent link">&para;</a></h2>
<p>Below are some example Web action declarations. Note that many of the annotations are optional.</p>
<p>Calls are authenticated at the service-level (service is listed in the @Authenticated annotation)
or at the user-level (user has at least one of the capabilities listed in the @Authenticated
annotation).</p>
<p>GET:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/hello/{name}&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Enclose path parameters in {}</span>
<span class="w">  </span><span class="nd">@ResponseContentType</span><span class="p">(</span><span class="n">MediaTypes</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@Authenticated</span><span class="p">(</span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;my-other-app&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;my-app_owners&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">    </span><span class="c1">// Use @PathParam with the name of the param. Required if there&#39;s a param in the path pattern.</span>
<span class="w">    </span><span class="nd">@PathParam</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// RequestHeaders is optional:</span>
<span class="w">    </span><span class="nd">@RequestHeaders</span><span class="w"> </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="n">Headers</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// QueryParams are optional:</span>
<span class="w">    </span><span class="nd">@QueryParam</span><span class="w"> </span><span class="n">nickName</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span><span class="p">,</span><span class="w"> </span><span class="c1">// e.g. /hello/abc?nickName=def</span>
<span class="w">    </span><span class="nd">@QueryParam</span><span class="w"> </span><span class="n">greetings</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;?</span><span class="w"> </span><span class="c1">// e.g. /hello/abc?greetings=def&amp;greetings=ghi</span>
<span class="w">  </span><span class="p">):</span><span class="w"> </span><span class="n">HelloResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>POST:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebPostAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Post</span><span class="p">(</span><span class="s">&quot;/hello/{name}&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@RequestContentType</span><span class="p">(</span><span class="n">MediaTypes</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@ResponseContentType</span><span class="p">(</span><span class="n">MediaTypes</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@Authenticated</span><span class="p">(</span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;my-other-app&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">capabilities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;my-app_owners&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span>
<span class="w">      </span><span class="nd">@PathParam</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="c1">// RequestBody is optional, and is automatically deserialized to the provided type.</span>
<span class="w">      </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="n">PostBody</span>
<span class="w">  </span><span class="p">):</span><span class="w"> </span><span class="n">HelloPostResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HelloPostResponse</span><span class="p">(</span><span class="n">body</span><span class="p">.</span><span class="na">greeting</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">HelloPostResponse</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">greeting</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PostBody</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">greeting</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
</code></pre></div>
<h3 id="setting-up-http-actions">Setting up HTTP actions<a class="headerlink" href="#setting-up-http-actions" title="Permanent link">&para;</a></h3>
<p>Install the action into a module:
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">HelloModule</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebActionModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">HelloWebAction</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebActionModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">HelloWebPostAction</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>And then put that module onto the top level <code>MiskApplication</code>.
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">MiskApplication</span><span class="p">(</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">HelloModule</span><span class="p">(),</span><span class="w"> </span><span class="c1">// new!</span>
<span class="w">  </span><span class="p">).</span><span class="na">run</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="response-type">Response type<a class="headerlink" href="#response-type" title="Permanent link">&para;</a></h3>
<p>If you change the action&rsquo;s response type to <code>Response&lt;T&gt;</code>, it gives you better control over the 
response status code and headers.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebResponseAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/hello_but_203/{name}&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@ResponseContentType</span><span class="p">(</span><span class="n">MediaTypes</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@PathParam</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">Response</span><span class="o">&lt;</span><span class="n">HelloResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Response</span><span class="p">(</span>
<span class="w">    </span><span class="n">statusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">203</span><span class="p">,</span>
<span class="w">    </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">headersOf</span><span class="p">(),</span>
<span class="w">    </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">()</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>It&rsquo;s also possible to throw exceptions that are mapped to status codes.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebResponseAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/no_access/{name}&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="nd">@PathParam</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">HelloResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">UnauthenticatedException</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="grpc-actions">gRPC Actions<a class="headerlink" href="#grpc-actions" title="Permanent link">&para;</a></h2>
<p>Misk has support for gRPC actions via the <a href="https://github.com/square/wire">Wire</a> protocol buffer
(protobuf) library.</p>
<p>To create a gRPC action, first define the relevant protos for your service. Let’s say we’re 
creating a <code>GreeterService</code> that exposes one API, <code>Hello</code>. Create this file in 
<code>src/main/proto/hello.proto</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;proto2&quot;</span><span class="p">;</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">squareup</span><span class="o">.</span><span class="n">cash.hello</span><span class="p">;</span>

<span class="k">option</span><span class="w"> </span><span class="na">java_package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;com.squareup.protos.cash.hello&quot;</span><span class="p">;</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">HelloRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="kd">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">HelloResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="kd">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">service</span><span class="w"> </span><span class="n">GreeterService</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">rpc</span><span class="w"> </span><span class="n">Hello</span><span class="p">(</span><span class="n">HelloRequest</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="p">(</span><span class="n">HelloResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<p>Next, in your project&rsquo;s build file (for this example, <code>build.gradle.kts</code>), add a dependency on the 
wire plugin:</p>
<div class="highlight"><pre><span></span><code>plugins {
  id(&quot;com.squareup.wire&quot;)
}
</code></pre></div>
<p>Add the following configuration to generate the gRPC interfaces for your service:</p>
<div class="highlight"><pre><span></span><code>wire {
  sourcePath {
    srcDir(&quot;src/main/proto&quot;)
  }

  kotlin {
    include(&quot;squareup.cash.hello.GreeterService&quot;)
    rpcCallStyle = &quot;blocking&quot;
    rpcRole = &quot;server&quot;
    singleMethodServices = true
  }

  java {
  }
}
</code></pre></div>
<p>Finally, implement and bind your gRPC action. <code>GreeterServiceHelloBlockingServer</code> is generated by
Wire.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloGrpcAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span>
<span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">GreeterServiceHelloBlockingServer</span><span class="p">,</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Unauthorized</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">Hello</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">HelloRequest</span><span class="p">):</span><span class="w"> </span><span class="n">HelloResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This module binds HelloGrpcAction.</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">GreeterActionModule</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebActionModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">HelloGrpcAction</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Misk also supports <code>rpcCallStyle = "suspending"</code> for suspending gRPC actions. This is the way to generate server 
actions if you intend to use coroutines to implement the business logic of your action. The generated interface will 
then expect you to implement a suspending function instead of a regular blocking function for your action&rsquo;s handler method. 
See <a href="../coroutines/">coroutines</a> for more information.</p>
<div class="highlight"><pre><span></span><code><span class="n">wire</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sourcePath</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">srcDir</span><span class="p">(</span><span class="s">&quot;src/main/proto&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">kotlin</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">include</span><span class="p">(</span><span class="s">&quot;squareup.cash.hello.GreeterService&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">rpcCallStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;suspending&quot;</span>
<span class="w">    </span><span class="n">rpcRole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;server&quot;</span>
<span class="w">    </span><span class="n">singleMethodServices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">java</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The above Wire Gradle plugin configuration will have a suspending function in the generated interface instead of a 
regular function. Your implementing class will then look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloGrpcAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span>
<span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">GreeterServiceHelloBlockingServer</span><span class="p">,</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@Unauthorized</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">Hello</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="w"> </span><span class="n">HelloRequest</span><span class="p">):</span><span class="w"> </span><span class="n">HelloResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Creating a gRPC action automatically creates a JSON endpoint with all of the same annotations in the 
path defined by the <code>...BlockingServer</code>, typically <code>/&lt;package&gt;.&lt;service name&gt;/&lt;rpc name&gt;</code>.</p>
<p>You can also create a second class that extends WebAction to customize this further. Read more about 
HTTP actions in <a href="#web-actions">Web Actions</a>. If you&rsquo;re building both a gRPC and a HTTP action, a 
common pattern is to have them both use a common dependency:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloGrpcAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">greeter</span><span class="p">:</span><span class="w"> </span><span class="n">Greeter</span><span class="p">)</span>
<span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">GreeterServiceHelloBlockingServer</span><span class="p">,</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Unauthorized</span><span class="w"> </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="n">greeter</span><span class="p">.</span><span class="na">greet</span><span class="p">())</span>
<span class="p">}</span>

<span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebAction</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">greeter</span><span class="p">:</span><span class="w"> </span><span class="n">Greeter</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebAction</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Unauthorized</span>
<span class="w">  </span><span class="nd">@Get</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@ResponseContentType</span><span class="p">(</span><span class="n">MediaTypes</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">)</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">hello</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="n">greeter</span><span class="p">.</span><span class="na">greet</span><span class="p">())</span>
<span class="p">}</span>

<span class="nd">@Singleton</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">Greeter</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">()</span><span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">greet</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello world&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="actionscoped">ActionScoped<a class="headerlink" href="#actionscoped" title="Permanent link">&para;</a></h2>
<p><code>ActionScoped</code> gives an action access to context produced by the action&rsquo;s interceptors.</p>
<p>Misk has a few <code>ActionScoped</code> items built in:</p>
<ul>
<li><a href="0.x/misk-actions/misk/-misk-caller/index.md"><code>MiskCaller</code></a> - access derived authorization details</li>
<li><a href="0.x/misk/misk.web/-http-call/index.md"><code>HttpCall</code></a> - access lower level HTTP details, e.g. 
  request headers</li>
</ul>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>Use <a href="../testing/">tests annotated with <code>@MiskTest</code></a> to perform tests. There are two common patterns
to testing actions:</p>
<h3 id="test-action-classes-directly">Test Action classes directly<a class="headerlink" href="#test-action-classes-directly" title="Permanent link">&para;</a></h3>
<p>Make sure that the module under test contains a Guice binding for the action and its dependencies, 
then inject your action.</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebActionModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">HelloWebAction</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">    </span><span class="c1">// Alternatively, a direct or just-in-time binding might be sufficient.</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@MiskTest</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MyTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyModule</span><span class="p">()</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="n">HelloWebAction</span>

<span class="w">  </span><span class="c1">// use action...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="testing-actionscoped">Testing <code>ActionScoped</code><a class="headerlink" href="#testing-actionscoped" title="Permanent link">&para;</a></h3>
<p>Use <code>@WithMiskCaller</code> for <code>ActionScoped&lt;MiskCaller&gt;</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@MiskTest</span>
<span class="nd">@WithMiskCaller</span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;test-user&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// or @WithMiskCaller(service = &quot;test-service&quot;)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MyTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyModule</span><span class="p">()</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="n">HelloWebAction</span><span class="w"> </span><span class="c1">// or any other class that injects ActionScoped&lt;MiskCaller&gt;</span>

<span class="w">  </span><span class="c1">// use action...</span>
<span class="p">}</span>
</code></pre></div>
<p>For types other than <code>MiskCaller</code>, use <code>ActionScope</code> directly either within your setup and teardown test methods:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@MiskTest</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MyTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyModule</span><span class="p">()</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">actionScope</span><span class="p">:</span><span class="w"> </span><span class="n">ActionScope</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="n">HelloWebAction</span><span class="w"> </span><span class="c1">// or any other class that injects ActionScoped&lt;MyScopedObject&gt;</span>

<span class="w">  </span><span class="nd">@BeforeEach</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">actionScope</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">      </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">keyOf</span><span class="o">&lt;</span><span class="n">MyScopedObject</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">MyScopedObject</span><span class="p">()</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">).</span><span class="na">enter</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@AfterEach</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">actionScope</span><span class="p">.</span><span class="na">close</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Test</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// use action...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>&hellip;or within the test itself:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@MiskTest</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MyTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyModule</span><span class="p">()</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">actionScope</span><span class="p">:</span><span class="w"> </span><span class="n">ActionScope</span>
<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">action</span><span class="p">:</span><span class="w"> </span><span class="n">HelloWebAction</span>

<span class="w">  </span><span class="nd">@Test</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">actionScope</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">      </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">        </span><span class="n">keyOf</span><span class="o">&lt;</span><span class="n">MyScopedObject</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">MyScopedObject</span><span class="p">()</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">).</span><span class="na">inScope</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// use action or class which injects ActionScoped&lt;MyScopedObject&gt;...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="integration-tests">Integration tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<p>It&rsquo;s possible to perform tests terminating at the app&rsquo;s HTTP/gRPC interface.</p>
<p>The module under test should include <code>WebServerTestingModule</code> so that Misk stands up a server during
tests:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">MyModule</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">(){</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebServerTestingModule</span><span class="p">())</span>
<span class="w">    </span><span class="c1">// install other modules...</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Then test HTTP requests using <code>WebTestClient</code> (assertions here were made using
 <a href="https://kotest.io/docs/assertions/assertions.html">Kotest</a>):</p>
<div class="highlight"><pre><span></span><code><span class="nd">@MiskTest</span><span class="p">(</span><span class="n">startService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">HelloWebIntegrationTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Suppress</span><span class="p">(</span><span class="s">&quot;unused&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyModule</span><span class="p">()</span>

<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">webTestClient</span><span class="p">:</span><span class="w"> </span><span class="n">WebTestClient</span>

<span class="w">  </span><span class="nd">@Test</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">`makes a call to the service`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">webTestClient</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HelloRequest</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">response</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="n">shouldBe</span><span class="w"> </span><span class="m">200</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">parseJson</span><span class="o">&lt;</span><span class="n">HelloResponse</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="n">shouldBe</span><span class="w"> </span><span class="n">HelloResponse</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Test gRPC requests by setting up a gRPC client pointing to the running app:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">MyServerModule</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebServerTestingModule</span><span class="p">())</span>
<span class="w">    </span><span class="c1">// Assume RobotLocatorWebAction is a gRPC action.</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">WebActionModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">RobotLocatorWebAction</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MyClientModule</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">jetty</span><span class="p">:</span><span class="w"> </span><span class="n">JettyService</span><span class="p">):</span><span class="w"> </span><span class="n">KAbstractModule</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Assume RobotLocator was generated via Wire.</span>
<span class="w">    </span><span class="n">install</span><span class="p">(</span><span class="n">GrpcClientModule</span><span class="p">.</span><span class="na">create</span><span class="o">&lt;</span><span class="n">RobotLocator</span><span class="p">,</span><span class="w"> </span><span class="n">GrpcRobotLocator</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;robots&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Provides</span>
<span class="w">  </span><span class="nd">@Singleton</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClientConfig</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClientsConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HttpClientsConfig</span><span class="p">(</span>
<span class="w">      </span><span class="n">endpoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;robots&quot;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">HttpClientEndpointConfig</span><span class="p">(</span><span class="n">jetty</span><span class="p">.</span><span class="na">httpServerUrl</span><span class="p">.</span><span class="na">toString</span><span class="p">())</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@MiskTest</span><span class="p">(</span><span class="n">startService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">RobotLocatorIntegrationTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Suppress</span><span class="p">(</span><span class="s">&quot;unused&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@MiskTestModule</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyServerModule</span><span class="p">()</span>

<span class="w">  </span><span class="nd">@Inject</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">jettyService</span><span class="p">:</span><span class="w"> </span><span class="n">JettyService</span>

<span class="w">  </span><span class="nd">@Test</span><span class="w"> </span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">`makes a call to the service`</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">robotLocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guice</span><span class="p">.</span><span class="na">createInjector</span><span class="p">(</span><span class="n">MyClientModule</span><span class="p">(</span><span class="n">jettyService</span><span class="p">))</span>
<span class="w">      </span><span class="p">.</span><span class="na">getInstance</span><span class="o">&lt;</span><span class="n">RobotLocator</span><span class="o">&gt;</span><span class="p">()</span>

<span class="w">    </span><span class="n">robotLocator</span><span class="p">.</span><span class="na">SayHello</span><span class="p">().</span><span class="na">executeBlocking</span><span class="p">(</span><span class="n">HelloRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">())</span><span class="w"> </span><span class="n">shouldBe</span><span class="w"> </span>
<span class="w">      </span><span class="n">HelloReply</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">message</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018-2021 Square, Inc.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>